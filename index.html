<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Space Shooter</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: black;
    }

    canvas {
      display: block;
      margin: 0 auto;
      background: black;
    }

    #score {
      color: white;
      font-family: Arial;
      font-size: 20px;
      position: absolute;
      top: 10px;
      left: 10px;
    }

    #restartBtn {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 10px 20px;
      font-size: 20px;
      background-color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="score">Score: 0</div>
  <button id="restartBtn">Restart Game</button>
  <canvas id="gameCanvas" width="800" height="500"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const spaceshipImg = new Image();
    spaceshipImg.src = "spaceship.png";

    const keys = {};
    window.addEventListener("keydown", e => keys[e.key] = true);
    window.addEventListener("keyup", e => keys[e.key] = false);

    const restartBtn = document.getElementById("restartBtn");
    restartBtn.addEventListener("click", () => {
      restartBtn.style.display = "none";
      resetGame();
    });

    let player, bullets, enemies, score, lives, gameOver, stars, playerProjectiles;

    function resetGame() {
      player = {
        x: 50,
        y: canvas.height / 2 - 20,
        width: 40,
        height: 40,
        speed: 4,
        lives: 3,
        canShoot: true,
        shootCooldown: 300,
      };

      bullets = [];
      enemies = [];
      playerProjectiles = [];
      score = 0;
      lives = 3;
      gameOver = false;

      stars = Array.from({ length: 100 }, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        size: Math.random() * 2,
        speed: 0.5 + Math.random() * 1
      }));

      document.getElementById("score").textContent = "Score: " + score;
      requestAnimationFrame(gameLoop);
    }

    function drawStars() {
      ctx.fillStyle = "white";
      stars.forEach(star => {
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
        ctx.fill();
        star.x -= star.speed;
        if (star.x < 0) {
          star.x = canvas.width;
          star.y = Math.random() * canvas.height;
        }
      });
    }

    function updatePlayer() {
      if (keys["ArrowUp"] || keys["w"]) player.y -= player.speed;
      if (keys["ArrowDown"] || keys["s"]) player.y += player.speed;
      if (keys["ArrowLeft"] || keys["a"]) player.x -= player.speed;
      if (keys["ArrowRight"] || keys["d"]) player.x += player.speed;

      player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
      player.y = Math.max(0, Math.min(canvas.height - player.height, player.y));

      // Space to shoot
      if ((keys[" "] || keys["Spacebar"]) && player.canShoot) {
        shoot();
        player.canShoot = false;
        setTimeout(() => { player.canShoot = true; }, player.shootCooldown);
      }
    }

    function drawPlayer() {
      ctx.drawImage(spaceshipImg, player.x, player.y, player.width, player.height);
    }

    function shoot() {
      playerProjectiles.push({
        x: player.x + player.width,
        y: player.y + player.height / 2 - 2,
        width: 10,
        height: 4,
        speed: 6
      });
    }

    function drawPlayerBullets() {
      ctx.fillStyle = "lime";
      playerProjectiles.forEach(b => {
        ctx.fillRect(b.x, b.y, b.width, b.height);
      });
    }

    function updatePlayerBullets() {
      playerProjectiles.forEach(b => { b.x += b.speed; });
      playerProjectiles = playerProjectiles.filter(b => b.x < canvas.width);

      // Collision with enemies
      for (let i = enemies.length - 1; i >= 0; i--) {
        for (let j = playerProjectiles.length - 1; j >= 0; j--) {
          const e = enemies[i];
          const b = playerProjectiles[j];
          if (
            b.x < e.x + e.width &&
            b.x + b.width > e.x &&
            b.y < e.y + e.height &&
            b.y + b.height > e.y
          ) {
            enemies.splice(i, 1);
            playerProjectiles.splice(j, 1);
            score += 10;
            document.getElementById("score").textContent = "Score: " + score;
            break;
          }
        }
      }
    }

    function spawnEnemy() {
      enemies.push({
        x: canvas.width,
        y: Math.random() * (canvas.height - 30),
        width: 30,
        height: 30,
        speed: 2
      });
    }

    function drawEnemies() {
      ctx.fillStyle = "red";
      enemies.forEach(e => {
        ctx.fillRect(e.x, e.y, e.width, e.height);
      });
    }

    function updateEnemies() {
      enemies.forEach(e => { e.x -= e.speed; });

      for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];
        if (e.x + e.width < 0) enemies.splice(i, 1); // off screen

        if (
          e.x < player.x + player.width &&
          e.x + e.width > player.x &&
          e.y < player.y + player.height &&
          e.y + e.height > player.y
        ) {
          enemies.splice(i, 1);
          lives--;
          if (lives <= 0) {
            gameOver = true;
            restartBtn.style.display = "block";
          }
        }
      }
    }

    function drawUI() {
      ctx.fillStyle = "lime";
      ctx.font = "16px Arial";
      ctx.fillText("Lives: " + lives, canvas.width - 100, 20);
    }

    function gameLoop() {
      if (gameOver) {
        ctx.fillStyle = "white";
        ctx.font = "36px Arial";
        ctx.fillText("Game Over", canvas.width / 2 - 100, canvas.height / 2);
        return;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawStars();
      updatePlayer();
      updateEnemies();
      updatePlayerBullets();

      drawPlayer();
      drawEnemies();
      drawPlayerBullets();
      drawUI();

      frame++;

      if (frame % 60 === 0) {
        spawnEnemy();
      }

      requestAnimationFrame(gameLoop);
    }

    let frame = 0;
    spaceshipImg.onload = () => {
      resetGame();
    };
  </script>
</body>
</html>
